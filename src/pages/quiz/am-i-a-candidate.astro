---
import Layout from "../../layouts/Layout.astro";

const title = "Am I A Candidate for TMS? | 2-Minute Eligibility Quiz";
const description =
    "Take our free, confidential assessment to see if Transcranial Magnetic Stimulation (TMS) therapy might be right for your treatment-resistant depression.";
---

<Layout title={title} description={description}>
    <main class="min-h-screen bg-gradient-to-b from-slate-50 to-white py-12">
        <div class="container mx-auto px-4 max-w-2xl">
            <!-- Progress Bar -->
            <div class="mb-8">
                <div
                    class="flex justify-between text-xs font-bold text-gray-500 mb-2 uppercase tracking-wide"
                >
                    <span>Assessment Progress</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div
                        id="progress-bar"
                        class="h-full bg-indigo-600 transition-all duration-500 ease-out"
                        style="width: 0%"
                    >
                    </div>
                </div>
            </div>

            <!-- Quiz Card -->
            <div
                class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden"
            >
                <!-- Intro Slide -->
                <div
                    id="slide-intro"
                    class="quiz-slide p-8 md:p-12 text-center"
                >
                    <div
                        class="w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6"
                    >
                        <svg
                            class="w-8 h-8"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            ><path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                            ></path></svg
                        >
                    </div>
                    <h1 class="text-3xl font-black text-gray-900 mb-4">
                        Is TMS Right For You?
                    </h1>
                    <p class="text-lg text-gray-600 mb-8 leading-relaxed">
                        TMS is an FDA-cleared treatment for depression that
                        hasn't responded to medications. Take this confidential
                        2-minute quiz to check your eligibility.
                    </p>
                    <button
                        onclick="nextSlide('intro', 'q1')"
                        class="w-full sm:w-auto px-8 py-4 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-all transform hover:-translate-y-1 shadow-lg shadow-indigo-200"
                    >
                        Start Assessment
                    </button>
                    <p class="text-xs text-gray-400 mt-6">
                        No personal information required to take the quiz.
                    </p>
                </div>

                <!-- Question 1: Diagnosis -->
                <div id="slide-q1" class="quiz-slide hidden p-8 md:p-12">
                    <span
                        class="text-indigo-600 font-bold text-sm tracking-wider uppercase mb-2 block"
                        >Question 1 of 5</span
                    >
                    <h2 class="text-2xl font-bold text-gray-900 mb-8">
                        Have you been diagnosed with Major Depressive Disorder
                        (MDD)?
                    </h2>
                    <div class="space-y-3">
                        <button
                            onclick="recordAnswer('diagnosis', true); nextSlide('q1', 'q2')"
                            class="w-full p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-gray-700 flex justify-between items-center group"
                        >
                            Yes, I have a formal diagnosis
                            <span
                                class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-indigo-600"
                            ></span>
                        </button>
                        <button
                            onclick="recordAnswer('diagnosis', true); nextSlide('q1', 'q2')"
                            class="w-full p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-gray-700 flex justify-between items-center group"
                        >
                            I suspect I have depression, but not diagnosed
                            <span
                                class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-indigo-600"
                            ></span>
                        </button>
                        <button
                            onclick="recordAnswer('diagnosis', false); nextSlide('q1', 'q2')"
                            class="w-full p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-gray-700 flex justify-between items-center group"
                        >
                            No
                            <span
                                class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-indigo-600"
                            ></span>
                        </button>
                    </div>
                </div>

                <!-- Question 2: Medication History -->
                <div id="slide-q2" class="quiz-slide hidden p-8 md:p-12">
                    <span
                        class="text-indigo-600 font-bold text-sm tracking-wider uppercase mb-2 block"
                        >Question 2 of 5</span
                    >
                    <h2 class="text-2xl font-bold text-gray-900 mb-8">
                        How many different antidepressants have you tried?
                    </h2>
                    <div class="space-y-3">
                        <button
                            onclick="recordAnswer('meds', 0); nextSlide('q2', 'q3')"
                            class="w-full p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-gray-700 flex justify-between items-center group"
                        >
                            None
                            <span
                                class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-indigo-600"
                            ></span>
                        </button>
                        <button
                            onclick="recordAnswer('meds', 1); nextSlide('q2', 'q3')"
                            class="w-full p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-gray-700 flex justify-between items-center group"
                        >
                            1 medication
                            <span
                                class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-indigo-600"
                            ></span>
                        </button>
                        <button
                            onclick="recordAnswer('meds', 2); nextSlide('q2', 'q3')"
                            class="w-full p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-gray-700 flex justify-between items-center group"
                        >
                            2 to 4 medications
                            <span
                                class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-indigo-600"
                            ></span>
                        </button>
                        <button
                            onclick="recordAnswer('meds', 5); nextSlide('q2', 'q3')"
                            class="w-full p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-gray-700 flex justify-between items-center group"
                        >
                            5 or more
                            <span
                                class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-indigo-600"
                            ></span>
                        </button>
                    </div>
                </div>

                <!-- Question 3: Side Effects -->
                <div id="slide-q3" class="quiz-slide hidden p-8 md:p-12">
                    <span
                        class="text-indigo-600 font-bold text-sm tracking-wider uppercase mb-2 block"
                        >Question 3 of 5</span
                    >
                    <h2 class="text-2xl font-bold text-gray-900 mb-8">
                        Are you experiencing side effects from your current
                        medications?
                    </h2>
                    <div class="space-y-3">
                        <button
                            onclick="recordAnswer('sideEffects', true); nextSlide('q3', 'q4')"
                            class="w-full p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-gray-700 flex justify-between items-center group"
                        >
                            Yes, they are bothersome
                            <span
                                class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-indigo-600"
                            ></span>
                        </button>
                        <button
                            onclick="recordAnswer('sideEffects', false); nextSlide('q3', 'q4')"
                            class="w-full p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-gray-700 flex justify-between items-center group"
                        >
                            No, or only mild side effects
                            <span
                                class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-indigo-600"
                            ></span>
                        </button>
                    </div>
                </div>

                <!-- Question 4: Current Status -->
                <div id="slide-q4" class="quiz-slide hidden p-8 md:p-12">
                    <span
                        class="text-indigo-600 font-bold text-sm tracking-wider uppercase mb-2 block"
                        >Question 4 of 5</span
                    >
                    <h2 class="text-2xl font-bold text-gray-900 mb-8">
                        Do you feel your depression has adequately improved with
                        medication?
                    </h2>
                    <div class="space-y-3">
                        <button
                            onclick="recordAnswer('improvement', true); nextSlide('q4', 'q5')"
                            class="w-full p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-gray-700 flex justify-between items-center group"
                        >
                            Yes, I feel much better
                            <span
                                class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-indigo-600"
                            ></span>
                        </button>
                        <button
                            onclick="recordAnswer('improvement', false); nextSlide('q4', 'q5')"
                            class="w-full p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-gray-700 flex justify-between items-center group"
                        >
                            No, I still have significant symptoms
                            <span
                                class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-indigo-600"
                            ></span>
                        </button>
                    </div>
                </div>

                <!-- Question 5: Insurance -->
                <div id="slide-q5" class="quiz-slide hidden p-8 md:p-12">
                    <span
                        class="text-indigo-600 font-bold text-sm tracking-wider uppercase mb-2 block"
                        >Last Question</span
                    >
                    <h2 class="text-2xl font-bold text-gray-900 mb-8">
                        Do you have health insurance?
                    </h2>
                    <div class="space-y-3">
                        <button
                            onclick="recordAnswer('insurance', true); showContactForm()"
                            class="w-full p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-gray-700 flex justify-between items-center group"
                        >
                            Yes, private insurance or Medicare
                            <span
                                class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-indigo-600"
                            ></span>
                        </button>
                        <button
                            onclick="recordAnswer('insurance', false); showContactForm()"
                            class="w-full p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-gray-700 flex justify-between items-center group"
                        >
                            No / Self-pay
                            <span
                                class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-indigo-600"
                            ></span>
                        </button>
                    </div>
                </div>

                <!-- Contact Form Gate -->
                <div
                    id="slide-contact"
                    class="quiz-slide hidden p-8 md:p-12 text-center"
                >
                    <span
                        class="text-indigo-600 font-bold text-sm tracking-wider uppercase mb-2 block"
                        >One Last Step</span
                    >
                    <h2 class="text-3xl font-black text-gray-900 mb-4">
                        Unlock Your Results
                    </h2>
                    <p class="text-lg text-gray-600 mb-8 max-w-lg mx-auto">
                        Enter your details below to see your eligibility
                        analysis and receive a copy via email.
                    </p>

                    <form
                        id="quiz-lead-form"
                        class="max-w-md mx-auto space-y-4"
                        onsubmit="event.preventDefault(); submitQuizAndShowResults();"
                    >
                        <div class="text-left">
                            <label
                                class="block text-sm font-bold text-gray-700 mb-1"
                                >Full Name</label
                            >
                            <input
                                type="text"
                                id="lead-name"
                                class="w-full rounded-xl border-gray-200 focus:ring-indigo-500 focus:border-indigo-500"
                                required
                                placeholder="John Doe"
                            />
                        </div>
                        <div class="text-left">
                            <label
                                class="block text-sm font-bold text-gray-700 mb-1"
                                >Email Address</label
                            >
                            <input
                                type="email"
                                id="lead-email"
                                class="w-full rounded-xl border-gray-200 focus:ring-indigo-500 focus:border-indigo-500"
                                required
                                placeholder="john@example.com"
                            />
                        </div>
                        <div class="text-left">
                            <label
                                class="block text-sm font-bold text-gray-700 mb-1"
                                >Phone Number (Optional)</label
                            >
                            <input
                                type="tel"
                                id="lead-phone"
                                class="w-full rounded-xl border-gray-200 focus:ring-indigo-500 focus:border-indigo-500"
                                placeholder="(555) 123-4567"
                            />
                        </div>

                        <button
                            type="submit"
                            class="w-full py-4 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 flex items-center justify-center gap-2"
                        >
                            <span>See My Results</span>
                            <svg
                                class="w-5 h-5"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                ><path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg
                            >
                        </button>
                    </form>
                </div>

                <!-- Result: High Candidate -->
                <div id="result-high" class="hidden p-8 md:p-12 text-center">
                    <div
                        class="w-20 h-20 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-6"
                    >
                        <svg
                            class="w-10 h-10"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            ><path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="3"
                                d="M5 13l4 4L19 7"></path></svg
                        >
                    </div>
                    <h2 class="text-3xl font-black text-gray-900 mb-4">
                        You Are a Strong Candidate
                    </h2>
                    <p class="text-lg text-gray-600 mb-8">
                        Based on your answers, you appear to meet the standard
                        FDA and insurance guidelines for TMS Therapy (diagnosis
                        of depression + medication resistance).
                    </p>
                    <div
                        class="bg-emerald-50 border border-emerald-100 rounded-xl p-4 mb-8 text-left"
                    >
                        <h4 class="font-bold text-emerald-800 mb-2">
                            Good News:
                        </h4>
                        <ul
                            class="text-emerald-700 text-sm space-y-1 list-disc list-inside"
                        >
                            <li>
                                Most insurance plans cover TMS for cases like
                                yours.
                            </li>
                            <li>
                                TMS specifically targets treatment-resistant
                                depression.
                            </li>
                            <li>It has fewer side effects than medications.</li>
                        </ul>
                    </div>
                    <a
                        href="/us/"
                        class="block w-full px-8 py-4 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 mb-4"
                    >
                        Find a Clinic Near You
                    </a>
                    <a
                        href="/insurance/"
                        class="text-indigo-600 font-bold hover:underline"
                        >Check Your Insurance Coverage</a
                    >
                </div>

                <!-- Result: Moderate/Low -->
                <div id="result-low" class="hidden p-8 md:p-12 text-center">
                    <div
                        class="w-20 h-20 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center mx-auto mb-6"
                    >
                        <svg
                            class="w-10 h-10"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            ><path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="3"
                                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                            ></path></svg
                        >
                    </div>
                    <h2 class="text-3xl font-black text-gray-900 mb-4">
                        You May Be a Candidate
                    </h2>
                    <p class="text-lg text-gray-600 mb-8">
                        You currently may not meet all the strict criteria for
                        automatic insurance coverage (often requires 2-4 failed
                        medications), but TMS could still effectively treat your
                        symptoms.
                    </p>
                    <p class="text-gray-500 mb-8 text-sm">
                        Many clinics offer self-pay options or can advocate for
                        coverage if you have severe side effects from
                        medications.
                    </p>
                    <a
                        href="/specialists/"
                        class="block w-full px-8 py-4 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 mb-4"
                    >
                        Talk to a TMS Specialist
                    </a>
                    <a
                        href="/us/"
                        class="text-gray-500 font-bold hover:text-gray-900 transition-colors"
                        >Browse Clinics Anyway</a
                    >
                </div>
            </div>
        </div>
    </main>
</Layout>

<script is:inline>
    const answers = {
        diagnosis: false,
        meds: 0,
        sideEffects: false,
        improvement: true,
        insurance: false,
    };

    const totalSlides = 6; // Intro + 5 Qs
    let currentSlideIndex = 0;

    function nextSlide(currentId, nextId) {
        document.getElementById(`slide-${currentId}`).classList.add("hidden");
        document.getElementById(`slide-${nextId}`).classList.remove("hidden");

        currentSlideIndex++;
        const progress = Math.min((currentSlideIndex / 5) * 100, 100);
        document.getElementById("progress-bar").style.width = `${progress}%`;
        document.getElementById("progress-text").innerText =
            `${Math.round(progress)}%`;
    }

    function recordAnswer(key, value) {
        answers[key] = value;
    }

    function showContactForm() {
        document.getElementById("slide-q5").classList.add("hidden");
        document.getElementById("slide-contact").classList.remove("hidden");
        document.getElementById("progress-bar").style.width = "95%";
        document.getElementById("progress-text").innerText = "Almost there...";
    }

    async function submitQuizAndShowResults() {
        const btn = document.querySelector("#quiz-lead-form button");
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = `<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Processing...`;

        const leadData = {
            type: "quiz-lead",
            name: document.getElementById("lead-name").value,
            email: document.getElementById("lead-email").value,
            phone: document.getElementById("lead-phone").value,
            quizAnswers: answers,
        };

        try {
            await fetch("/api/submit", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(leadData),
            });
        } catch (e) {
            console.error("Submission error", e);
        }

        // Show Results regardless of API success (don't block user)
        document.getElementById("slide-contact").classList.add("hidden");
        document.getElementById("progress-bar").style.width = "100%";
        document.getElementById("progress-text").innerText = "100%";

        // Logic: Strong Candidate if Diagnosis=Yes AND Meds>=2 AND Improvement=No
        const isStrongCandidate =
            answers.diagnosis === true &&
            answers.meds >= 2 &&
            answers.improvement === false;

        if (isStrongCandidate) {
            document.getElementById("result-high").classList.remove("hidden");
        } else {
            document.getElementById("result-low").classList.remove("hidden");
        }
    }
</script>
