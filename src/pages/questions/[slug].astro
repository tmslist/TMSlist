---
import Layout from "../../layouts/Layout.astro";
import questionsData from "../../data/questions-seed.json";

export async function getStaticPaths() {
    return questionsData.map((q) => ({
        params: { slug: q.slug },
        props: { question: q },
    }));
}

const { question } = Astro.props;

// Smart related questions: mix of same category and different categories
const sameCategory = questionsData
    .filter((q) => q.category === question.category && q.id !== question.id)
    .slice(0, 3);

const otherCategories = questionsData
    .filter((q) => q.category !== question.category && q.id !== question.id)
    .slice(0, 3);

const relatedQs = [...sameCategory, ...otherCategories].slice(0, 6);

const title = `${question.question} | TMS List Expert Answers`;
const description = question.quickAnswer;
---

<Layout title={title} description={description}>
    <main class="container mx-auto px-4 py-12 max-w-4xl">
        <!-- Breadcrumb -->
        <nav class="text-sm text-gray-500 mb-6">
            <a href="/" class="hover:text-gray-900">Home</a>
            <span class="mx-2">/</span>
            <a href="/questions/" class="hover:text-gray-900">Questions</a>
            <span class="mx-2">/</span>
            <span class="text-gray-900">{question.category}</span>
        </nav>

        <!-- Question Header -->
        <h1
            class="text-4xl md:text-5xl font-bold text-gray-900 mb-6 leading-tight"
        >
            {question.question}
        </h1>

        <!-- Quick Answer Box -->
        <div
            class="bg-indigo-50 border-l-4 border-indigo-600 p-6 mb-8 rounded-r-lg"
        >
            <h2 class="text-lg font-bold text-indigo-900 mb-2">Quick Answer</h2>
            <p class="text-gray-800 leading-relaxed">{question.quickAnswer}</p>
        </div>

        <!-- Main Content -->
        <article class="prose prose-lg prose-indigo max-w-none mb-12">
            <h2>Detailed Explanation</h2>
            <p>
                {question.question} This is a common question among patients considering
                TMS therapy. Understanding the full context can help you make an informed
                decision about your mental health treatment.
            </p>

            <p
                class="text-gray-600 italic text-sm border-l-2 border-gray-200 pl-4 py-2 my-6"
            >
                üí° <strong>Note:</strong> This answer is based on FDA-cleared treatments
                and peer-reviewed clinical research. Always consult with a qualified
                healthcare provider for personalized medical advice.
            </p>

            <!-- Key Takeaways -->
            <h2>Key Takeaways</h2>
            <ul class="space-y-2">
                <li>TMS is an FDA-cleared, evidence-based treatment</li>
                <li>
                    Most insurance plans cover TMS for treatment-resistant
                    depression
                </li>
                <li>
                    Results typically appear after 4-6 weeks of daily sessions
                </li>
                <li>Side effects are minimal compared to medication</li>
            </ul>
        </article>

        <!-- Enhanced CTAs Grid -->
        <section class="my-12 grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Find Clinics CTA -->
            <div
                class="bg-gradient-to-br from-indigo-600 to-indigo-700 rounded-2xl p-6 text-white"
            >
                <div class="text-3xl mb-3">üè•</div>
                <h3 class="text-xl font-bold mb-2">
                    Find TMS Clinics Near You
                </h3>
                <p class="text-indigo-100 text-sm mb-4">
                    Browse verified providers, compare prices & insurance
                </p>
                <div class="flex gap-2">
                    <a
                        href="/us/"
                        class="px-4 py-2 bg-white text-indigo-600 font-semibold rounded-lg hover:bg-gray-100 transition-colors text-sm"
                    >
                        Browse Clinics
                    </a>
                    <button
                        onclick="document.dispatchEvent(new Event('open-enquiry-modal'))"
                        class="px-4 py-2 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-400 transition-colors border border-white/20 text-sm"
                    >
                        Talk to Specialist
                    </button>
                </div>
            </div>

            <!-- Lead Magnet CTA -->
            <div
                class="bg-gradient-to-br from-blue-600 to-cyan-600 rounded-2xl p-6 text-white"
            >
                <div class="text-3xl mb-3">üì•</div>
                <h3 class="text-xl font-bold mb-2">Free TMS Guide</h3>
                <p class="text-blue-100 text-sm mb-4">
                    Download: "TMS vs Medication - Which is Right for You?"
                </p>
                <button
                    onclick="document.dispatchEvent(new Event('open-lead-magnet'))"
                    class="px-4 py-2 bg-white text-blue-600 font-semibold rounded-lg hover:bg-gray-100 transition-colors inline-flex items-center gap-2 text-sm"
                >
                    <svg
                        class="w-4 h-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        ><path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                        ></path></svg
                    >
                    Download Free
                </button>
            </div>
        </section>

        <!-- Related Questions -->
        {
            relatedQs.length > 0 && (
                <section class="bg-gray-50 rounded-xl p-8 mb-12">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-900">
                            People Also Ask
                        </h2>
                        <a
                            href="/questions/"
                            class="text-indigo-600 font-semibold hover:underline text-sm"
                        >
                            Browse All ‚Üí
                        </a>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {relatedQs.map((rq) => (
                            <a
                                href={`/questions/${rq.slug}/`}
                                class="group block p-4 bg-white rounded-lg border-2 border-gray-200 hover:border-indigo-500 hover:shadow-md transition-all"
                            >
                                <h3 class="font-semibold text-gray-900 group-hover:text-indigo-600 transition-colors mb-2 text-sm line-clamp-2">
                                    {rq.question}
                                </h3>
                                <p class="text-xs text-gray-600 line-clamp-2 mb-2">
                                    {rq.quickAnswer.slice(0, 80)}...
                                </p>
                                <span class="text-xs text-indigo-600 font-medium group-hover:underline">
                                    Read Answer ‚Üí
                                </span>
                            </a>
                        ))}
                    </div>
                    <div class="mt-6 text-center">
                        <a
                            href={`/questions/category/${question.category}/`}
                            class="inline-block px-5 py-2.5 bg-white text-indigo-600 font-semibold rounded-lg hover:bg-gray-100 transition-colors border-2 border-indigo-200"
                        >
                            More {question.category} Questions ‚Üí
                        </a>
                    </div>
                </section>
            )
        }

        <!-- Medical Disclaimer -->
        <div class="border-t border-gray-200 pt-8 text-sm text-gray-600">
            <h3 class="font-bold text-gray-900 mb-2">Medical Disclaimer</h3>
            <p>
                The information provided on this page is for educational
                purposes only and is not intended as medical advice. TMS List
                does not provide medical advice, diagnosis, or treatment. Always
                consult with a qualified healthcare provider regarding any
                questions you may have about a medical condition or treatment.
            </p>
            <p class="mt-4">
                <strong>Last Updated:</strong>
                {
                    new Date().toLocaleDateString("en-US", {
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                    })
                }
            </p>
        </div>

        <!-- Schema Markup -->
        <script
            type="application/ld+json"
            set:html={JSON.stringify({
                "@context": "https://schema.org",
                "@type": "FAQPage",
                mainEntity: {
                    "@type": "Question",
                    name: question.question,
                    acceptedAnswer: {
                        "@type": "Answer",
                        text: question.quickAnswer,
                    },
                },
            })}
        />
    </main>
</Layout>
