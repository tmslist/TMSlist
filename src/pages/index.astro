---
import Layout from "../layouts/Layout.astro";

import {
    getOperationalClinics,
    getClinicPhoto,
    getClinicRating,
    getClinicReviewCount,
    getTotalDoctorCount,
    getStateSlug,
} from "../utils/dataHelpers";
import type { Clinic } from "../types/clinic";
import {
    TREATMENT_SLUGS,
    TECHNOLOGY_SLUGS,
    INSURANCE_SLUGS,
} from "../utils/seo_slugs";

// Use ONLY verified real clinics from the main DB
const clinics = getOperationalClinics();

const STATE_NAMES: Record<string, string> = {
    DC: "Washington DC",
    CA: "California",
    FL: "Florida",
    NY: "New York",
    AZ: "Arizona",
    CT: "Connecticut",
    NJ: "New Jersey",
    TX: "Texas",
    IL: "Illinois",
    PA: "Pennsylvania",
    OH: "Ohio",
    MI: "Michigan",
    WA: "Washington",
    CO: "Colorado",
    GA: "Georgia",
};

// Group clinics by state for the location grid
const stateGroups = clinics.reduce(
    (acc, clinic) => {
        const stateCode = clinic.state;
        if (!acc[stateCode]) acc[stateCode] = [];
        acc[stateCode].push(clinic);
        return acc;
    },
    {} as Record<string, Clinic[]>,
);

const locationMap = Object.entries(stateGroups)
    .map(([stateCode, stateClinics]) => {
        const cities = [...new Set(stateClinics.map((c) => c.city))].sort();
        return {
            code: stateCode,
            name: STATE_NAMES[stateCode] || stateCode,
            slug: getStateSlug(stateCode),
            cities: cities,
            clinicCount: stateClinics.length,
        };
    })
    .sort((a, b) => b.clinicCount - a.clinicCount);

const uniqueStates = Object.keys(stateGroups);

// LOGIC: Get top rated VERIFIED clinics, ensuring geographic diversity (1 per city)
// 1. Filter for Verified + High Rating
const qualifiedClinics = clinics.filter(
    (c) =>
        (c.verified || getClinicRating(c) >= 4.9) &&
        getClinicReviewCount(c) > 10 &&
        c.city,
);

// 2. Group by City
const cityGroups = qualifiedClinics.reduce(
    (acc, clinic) => {
        if (!acc[clinic.city]) acc[clinic.city] = [];
        acc[clinic.city].push(clinic);
        return acc;
    },
    {} as Record<string, Clinic[]>,
);

// 3. Pick best clinic from each city
const bestInCity = Object.values(cityGroups).map((cityClinics) => {
    return cityClinics.sort(
        (a, b) => getClinicRating(b) - getClinicRating(a),
    )[0];
});

// 4. Sort by overall rating/verified status and take top 6
const topClinics = bestInCity
    .sort((a, b) => {
        // Prioritize verified
        if (a.verified && !b.verified) return -1;
        if (!a.verified && b.verified) return 1;
        // Then rating
        return getClinicRating(b) - getClinicRating(a);
    })
    .slice(0, 6);
const totalDoctors = getTotalDoctorCount();
const featuredTech = TECHNOLOGY_SLUGS.slice(0, 4);

// Prepare search data for autocomplete
const searchData = [
    // States
    ...Object.entries(stateGroups).map(([code, _]) => ({
        label: STATE_NAMES[code] || code,
        subLabel: "State",
        value: `/us/${getStateSlug(code)}/`,
        type: "state",
    })),
    // Cities
    ...Object.values(cityGroups)
        .flat()
        .reduce((acc, clinic) => {
            const cityState = `${clinic.city}, ${clinic.state}`;
            if (!acc.find((i) => i.label === cityState)) {
                acc.push({
                    label: cityState,
                    subLabel: "City",
                    value: `/us/${getStateSlug(clinic.state)}/${clinic.city.toLowerCase().replace(/[^a-z0-9]+/g, "-")}/`,
                    type: "city",
                });
            }
            return acc;
        }, [] as any[]),
    // Zip Codes
    ...clinics.reduce((acc, clinic) => {
        if (!acc.find((i) => i.label === clinic.zip)) {
            acc.push({
                label: clinic.zip,
                subLabel: `${clinic.city}, ${clinic.state}`,
                value: `/us/?q=${clinic.zip}`,
                type: "zip",
            });
        }
        return acc;
    }, [] as any[]),
];
---

<Layout
    title="TMS List - America's #1 Verified TMS Therapy Directory | Find Clinics Near You"
>
    <!-- HERO SECTION - Revamped -->
    <section class="relative container mx-auto rounded-3xl px-8 bg-[#2E073F] overflow-hidden  pb-8">
        <!-- Background Effects -->
        <div class="absolute inset-0 z-0">
            <!-- New Theme Purple Blob -->
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[600px] bg-[#5F00C2]/20 rounded-full blur-[120px] animate-pulse"></div>
            <!-- Cyan Contrast -->
            <div class="absolute bottom-0 right-0 w-[800px] h-[600px] bg-cyan-600/10 rounded-full blur-[100px]"></div>
            <div class="absolute inset-0 bg-[url('/grid.svg')] opacity-[0.03]"></div>
        </div>

        <div class="container mx-auto px-4 relative z-10">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-8 items-center">
                <!-- Left: Content -->
                <div class="text-center lg:text-left max-w-2xl mx-auto lg:mx-0">
                    <!-- Trust Badge -->
                    <div
                        class="inline-flex items-center gap-2.5 bg-white/5 backdrop-blur-md border border-white/10 rounded-full py-2 px-5 mb-8 shadow-xl shadow-[#5F00C2]/10 hover:bg-white/10 transition-colors"
                    >
                        <span class="relative flex h-2.5 w-2.5">
                            <span
                                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"
                            ></span>
                            <span
                                class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"
                            ></span>
                        </span>
                        <span class="text-sm font-bold text-white tracking-wide"
                            >{clinics.length}+ Verified Clinics Added</span
                        >
                    </div>

                    <h1
                        class="text-5xl lg:text-7xl font-black text-white mb-6 tracking-tight leading-[1.1]"
                    >
                        Find <span
                            class="text-violet-500"
                            >TMS Therapy</span
                        >
                        <br />
                        <span class="relative whitespace-nowrap">
                            Near You
                            <!-- Underline using new purple -->
                            <svg class="absolute -bottom-2 left-0 w-full h-3 text-[#5F00C2]/50 -z-10" viewBox="0 0 100 10" preserveAspectRatio="none">
                                <path d="M0 5 Q 50 10 100 5" stroke="currentColor" stroke-width="8" fill="none" />
                            </svg>
                        </span>
                    </h1>

                    <p
                        class="text-lg md:text-xl text-slate-300 mb-2 leading-relaxed font-light"
                    >
                        America's most comprehensive directory of <strong class="text-white font-semibold">FDA-cleared</strong> Transcranial Magnetic Stimulation clinics. Verified patient reviews, insurance data, and expert providers.
                    </p>

                    <!-- Search Box -->
                    <form id="hero-search-form" class="relative max-w-lg mx-auto lg:mx-0 mb-4 z-20" action="/us/">
                        <div class="relative group">
                            <!-- Gradient Border using new purple -->
                            <div class="absolute -inset-1 bg-gradient-to-r from-cyan-500 to-[#5F00C2] rounded-2xl blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200"></div>
                            <div class="relative flex flex-col sm:flex-row bg-slate-900/90 backdrop-blur-xl border border-white/10 rounded-xl p-2 shadow-2xl ring-1 ring-white/10">
                                <div class="flex-1 relative flex items-center px-4 h-14">
                                    <svg
                                        class="w-6 h-6 text-slate-400 mr-3"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                                        ></path>
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                                        ></path>
                                    </svg>
                                    <input
                                        type="text"
                                        name="q"
                                        id="hero-search-input"
                                        autocomplete="off"
                                        placeholder="City, state, or zip code..."
                                        class="w-full bg-transparent text-white placeholder-slate-400 font-medium text-lg outline-none border-none focus:ring-0 p-0"
                                    />
                                    <!-- Autocomplete Dropdown -->
                                    <div
                                        id="search-suggestions"
                                        class="absolute top-16 left-0 right-0 bg-white rounded-xl shadow-2xl border border-gray-100 overflow-hidden hidden z-50 max-h-[300px] overflow-y-auto"
                                    >
                                    </div>
                                </div>
                                <button
                                    type="submit"
                                    class="h-14 px-6 bg-gradient-to-r from-[#5F00C2] to-[#7C3AED] hover:from-[#4C1D95] hover:to-[#5F00C2] text-white font-bold rounded-lg transition-all shadow-lg hover:shadow-[#5F00C2]/25 flex items-center justify-center gap-2 whitespace-nowrap mt-2 sm:mt-0"
                                >
                                    <span>Search</span>
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </form>

                    <!-- Quick Links -->
                    <div
                        class="flex flex-wrap items-center justify-center lg:justify-start gap-3"
                    >
                        <span class="text-sm font-semibold text-slate-400">Popular:</span>
                        <a
                            href="/us/california/"
                            class="px-4 py-1.5 bg-white/5 hover:bg-white/10 border border-white/5 hover:border-white/20 rounded-full text-xs font-medium text-slate-300 hover:text-white transition-all"
                            >California</a
                        >
                        <a
                            href="/us/texas/"
                            class="px-4 py-1.5 bg-white/5 hover:bg-white/10 border border-white/5 hover:border-white/20 rounded-full text-xs font-medium text-slate-300 hover:text-white transition-all"
                            >Texas</a
                        >
                        <a
                            href="/us/new-york/"
                            class="px-4 py-1.5 bg-white/5 hover:bg-white/10 border border-white/5 hover:border-white/20 rounded-full text-xs font-medium text-slate-300 hover:text-white transition-all"
                            >New York</a
                        >
                        <a
                            href="/treatments/depression/"
                            class="px-4 py-1.5 bg-[#5F00C2]/20 hover:bg-[#5F00C2]/30 border border-[#5F00C2]/30 hover:border-[#5F00C2]/50 rounded-full text-xs font-semibold text-white hover:text-white transition-all flex items-center gap-1.5"
                        >
                            <span class="w-1.5 h-1.5 rounded-full bg-[#7C3AED]"></span>
                            Depression
                        </a>
                    </div>
                </div>

                <!-- Right: Visual -->
                <div class="relative flex items-center justify-center lg:justify-end perspective-1000">
                    <div class="relative w-full max-w-[600px] aspect-square">
                        <!-- Glow Effect with New Purple -->
                        <div class="absolute inset-0 bg-gradient-to-tr from-cyan-500/30 to-[#5F00C2]/30 blur-[80px] rounded-full animate-pulse-slow"></div>
                        
                        <!-- Main Image -->
                        <img
                            src="/images/brain.png"
                            alt="TMS Brain Mapping Visualization"
                            class="relative w-full h-full object-contain drop-shadow-[0_20px_50px_rgba(0,0,0,0.5)] z-10 animate-float scale-110"
                        />

                        <!-- Floating Cards are currently commented out in source, keeping them commented or removed to match view -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- STATS RIBBON - Redesigned -->
    <div class="relative -mt-16 z-30 container mx-auto px-4">
        <div class="bg-white rounded-3xl shadow-2xl shadow-indigo-900/10 p-8 lg:p-4 ">
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-8 lg:gap-0 divide-y lg:divide-y-0 lg:divide-x divide-slate-100 ">
                <div class="text-center px-4 pb-4 lg:pb-0">
                    <div class="flex items-center justify-center gap-2 mb-2 text-indigo-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                        <span class="text-3xl lg:text-4xl font-semibold tracking-tight">{clinics.length}+</span>
                    </div>
                    <div class="text-sm font-semibold text-slate-500 uppercase tracking-wide">Verified Clinics</div>
                </div>

                <div class="text-center px-4 py-4 lg:py-0">
                     <div class="flex items-center justify-center gap-2 mb-2 text-indigo-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span class="text-3xl lg:text-4xl font-black tracking-tight">{uniqueStates.length}</span>
                    </div>
                    <div class="text-sm font-bold text-slate-500 uppercase tracking-wide">States Covered</div>
                </div>

                <div class="text-center px-4 py-4 lg:py-0">
                     <div class="flex items-center justify-center gap-2 mb-2 text-indigo-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span class="text-3xl lg:text-4xl font-black tracking-tight">60%</span>
                    </div>
                    <div class="text-sm font-bold text-slate-500 uppercase tracking-wide">Remission Rate</div>
                </div>

                <div class="text-center px-4 pt-4 lg:pt-0">
                    <div class="flex items-center justify-center gap-2 mb-2 text-indigo-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                        <span class="text-3xl lg:text-4xl font-black tracking-tight">{totalDoctors}+</span>
                    </div>
                    <div class="text-sm font-bold text-slate-500 uppercase tracking-wide">TMS Specialists</div>
                </div>
            </div>
        </div>
    </div>

    <!-- HOW TMS WORKS - Informational/Corporate -->
    <section class="py-10 bg-slate-50 border-y border-slate-200">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
                <!-- Text Content -->
                <div>
                    <div class="flex items-center gap-2 mb-6">
                        <span class="w-10 h-[1px] bg-[#5F00C2]"></span>
                        <span class="text-sm font-bold text-[#5F00C2] uppercase tracking-widest">Mechanism of Action</span>
                    </div>
                    
                    <h2 class="text-3xl md:text-4xl font-serif text-slate-900 mb-6 leading-tight">
                        Precision Medicine for <br/>
                        <span class="italic text-slate-600">Neural Health</span>
                    </h2>

                    <p class="text-lg text-slate-600 mb-8 leading-relaxed font-light">
                        Transcranial Magnetic Stimulation (TMS) operates on the principle of electromagnetic induction. By delivering highly focused magnetic pulses to the prefrontal cortex—the area of the brain associated with mood regulation—TMS stimulates neurons that have become underactive due to depression or other conditions.
                    </p>

                    <div class="space-y-8">
                        <div class="flex gap-4">
                            <div class="w-12 h-12 rounded-full bg-white border border-slate-100 shadow-sm flex items-center justify-center shrink-0 text-[#5F00C2]">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-bold text-slate-900 mb-2">Targeted Stimulation</h4>
                                <p class="text-slate-500 text-sm leading-relaxed">
                                    Unlike medications which circulate systemically, TMS targets specific neural circuits, minimizing systemic side effects.
                                </p>
                            </div>
                        </div>

                        <div class="flex gap-4">
                            <div class="w-12 h-12 rounded-full bg-white border border-slate-100 shadow-sm flex items-center justify-center shrink-0 text-[#5F00C2]">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-bold text-slate-900 mb-2">Neuroplasticity Support</h4>
                                <p class="text-slate-500 text-sm leading-relaxed">
                                    Repeated stimulation encourages neuroplasticity, strengthening synaptic connections and potentially restoring healthy brain function over time.
                                </p>
                            </div>
                        </div>

                         <div class="flex gap-4">
                            <div class="w-12 h-12 rounded-full bg-white border border-slate-100 shadow-sm flex items-center justify-center shrink-0 text-[#5F00C2]">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-bold text-slate-900 mb-2">Evidence-Based Protocol</h4>
                                <p class="text-slate-500 text-sm leading-relaxed">
                                    Cleared by the FDA in 2008, TMS is backed by extensive clinical research demonstrating efficacy in treatment-resistant cases.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="mt-10 pt-8 border-t border-slate-200">
                         <a href="/science/" class="text-[#5F00C2] font-semibold text-sm hover:text-[#4C1D95] transition-colors flex items-center gap-2">
                            Explore the Clinical Research
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        </a>
                    </div>
                </div>

                <!-- Visual -->
                <div class="relative">
                    <div class="bg-white p-2 rounded-3xl shadow-2xl shadow-slate-200 border border-slate-100">
                        <div class="relative aspect-[4/3] rounded-2xl overflow-hidden bg-slate-50">
                             <img
                                src="/images/tms_diagram.png"
                                alt="Scientific Diagram of TMS Mechanism"
                                class="w-full h-full object-cover"
                            />
                        </div>
                        <div class="p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Figure 1.1</div>
                                    <div class="text-sm font-bold text-slate-800">Electromagnetic Induction Field</div>
                                </div>
                                <div class="w-8 h-8 rounded-full bg-[#5F00C2]/10 flex items-center justify-center text-[#5F00C2]">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Context Card (Static, Professional) -->
                    <div class="absolute -bottom-6 -left-6 bg-slate-800 text-white p-6 rounded-xl shadow-xl max-w-xs hidden md:block">
                        <div class="flex items-start gap-4">
                            <div class="text-3xl font-serif italic text-[#7C3AED]">"</div>
                            <p class="text-sm text-slate-300 italic leading-relaxed">
                                A targeted, non-invasive approach to mental health that bridges the gap between pharmacology and psychotherapy.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FEATURED CLINICS - Revamped list style -->
    <section class="py-8 bg-slate-50/50">
        <div class="container mx-auto px-4">
            <div class="flex items-end justify-between mb-8">
                <div>
                    <span
                        class="inline-block px-3 py-1 bg-[#5F00C2]/10 text-[#5F00C2] rounded-full text-xs font-bold uppercase tracking-wider mb-2"
                        >Top Rated</span
                    >
                    <h2 class="text-3xl md:text-4xl font-black text-slate-900">
                        Featured Clinics
                    </h2>
                </div>
                <a
                    href="/us/"
                    class="text-[#5F00C2] font-bold text-sm hover:text-[#4C1D95] flex items-center gap-1 group"
                    >View All Clinics <span class="group-hover:translate-x-1 transition-transform">→</span></a
                >
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                {
                    topClinics.slice(0, 12).map((clinic) => (
                        <div class="group bg-white rounded-3xl p-4 shadow-sm hover:shadow-2xl transition-all duration-300 border border-slate-100 hover:border-[#5F00C2]/20 flex flex-col sm:flex-row gap-5">
                            <!-- Image Section -->
                            <div class="relative w-full sm:w-48 h-56 sm:h-auto shrink-0 rounded-2xl overflow-hidden bg-slate-100">
                                <img
                                    src={
                                        clinic.hero_image_url ||
                                        `/images/tms_chair_luxury_1769446442231.png`
                                    }
                                    alt={clinic.name}
                                    class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                                    loading="lazy"
                                />
                                {clinic.verified && (
                                    <div class="absolute bottom-2 left-2 right-2 bg-white/95 backdrop-blur-sm py-1.5 px-3 rounded-lg flex items-center justify-center gap-1.5 shadow-sm">
                                        <svg class="w-3.5 h-3.5 text-emerald-500" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                        </svg>
                                        <span class="text-[10px] font-bold text-slate-700 uppercase tracking-wide">Verified</span>
                                    </div>
                                )}
                            </div>

                            <!-- Content Section -->
                            <div class="flex-1 flex flex-col justify-between py-1">
                                <div>
                                    <div class="flex items-start justify-between gap-2 mb-2">
                                        <h3 class="font-black text-lg text-slate-900 leading-tight group-hover:text-[#5F00C2] transition-colors">
                                            {clinic.name}
                                        </h3>
                                        <button class="text-slate-300 hover:text-red-500 transition-colors">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                                        </button>
                                    </div>

                                    <!-- Ratings Row -->
                                    <div class="flex items-center flex-wrap gap-2 mb-3">
                                        <span class="bg-emerald-600 text-white text-xs font-bold px-2.5 py-1 rounded-md flex items-center gap-1">
                                            {typeof clinic.rating === 'number' ? clinic.rating.toFixed(1) : clinic.rating?.aggregate.toFixed(1) || 'N/A'} <span class="text-emerald-100">★</span>
                                        </span>
                                        <span class="text-xs font-semibold text-slate-500">
                                            {getClinicReviewCount(clinic)} Ratings
                                        </span>
                                        <span class="hidden sm:inline-block w-1 h-1 rounded-full bg-slate-300"></span>
                                        <span class="flex items-center gap-1 bg-amber-100 text-amber-700 px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide">
                                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                                            Trusted
                                        </span>
                                    </div>

                                    <!-- Address -->
                                    <div class="flex items-start gap-1.5 text-sm text-slate-500 mb-3">
                                        <svg class="w-4 h-4 text-slate-400 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                        <span class="line-clamp-1">{clinic.address || `${clinic.city}, ${clinic.state}`}</span>
                                    </div>

                                    <!-- Features/Tags -->
                                    <div class="flex flex-wrap gap-2 mb-4">
                                        {clinic.machines.slice(0, 3).map((m) => (
                                            <span class="px-2 py-0.5 bg-slate-100 border border-slate-200 rounded text-[10px] font-semibold text-slate-600">
                                                {m}
                                            </span>
                                        ))}
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="grid grid-cols-2 sm:grid-cols-[auto_1fr_auto] gap-2 mt-auto">
                                    <!-- Call Button -->
                                    <a href={`tel:${clinic.phone}`} class="col-span-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-bold text-sm transition-colors shadow-lg shadow-emerald-500/20">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                                        <span class="hidden sm:inline">Call</span>
                                    </a>
                                    
                                    <!-- Book Button -->
                                    <a href={`/clinic/${clinic.slug}`} class="col-span-1 sm:col-span-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-[#5F00C2] hover:bg-[#4C1D95] text-white rounded-lg font-bold text-sm transition-colors shadow-lg shadow-[#5F00C2]/20">
                                        Book Appointment
                                    </a>

                                    <!-- WhatsApp/More (Desktop) -->
                                    <button class="hidden sm:flex items-center justify-center w-10 h-10 border border-slate-200 rounded-lg text-slate-500 hover:text-emerald-500 hover:border-emerald-500 hover:bg-emerald-50 transition-all">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    ))
                }
            </div>
        </div>
    </section>

    <!-- CONDITIONS - Aesthetic Bento Grid -->
    <section class="py-10 container mx-auto px-4 bg-[#0f0518] rounded-3xl relative overflow-hidden">
        <!-- Background Ambient Glow -->
        <div class="absolute top-0 left-1/4 w-[500px] h-[500px] bg-[#5F00C2]/20 rounded-full blur-[120px] pointer-events-none"></div>
        <div class="absolute bottom-0 right-1/4 w-[500px] h-[500px] bg-cyan-500/10 rounded-full blur-[120px] pointer-events-none"></div>

        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center mb-8">
                <span
                    class="inline-block px-3 py-1 bg-[#5F00C2]/20 text-[#7C3AED] border border-[#5F00C2]/30 rounded-full text-xs font-bold uppercase tracking-wider mb-2"
                    >Conditions Treated</span
                >
                <h2 class="text-3xl md:text-5xl font-black text-white tracking-tight">
                    FDA-Cleared <span class="text-transparent bg-clip-text bg-gradient-to-r from-[#7C3AED] to-cyan-400">Protocols</span>
                </h2>
                <p class="text-slate-400 mt-2 max-w-2xl mx-auto text-sm font-light">
                    TMS is FDA-cleared for multiple mental health conditions, providing a non-invasive alternative when medication hasn't yielded results.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Large Feature Card: Depression -->
                <a
                    href="/treatments/depression/"
                    class="col-span-1 md:col-span-2 row-span-2 group relative overflow-hidden rounded-3xl bg-gradient-to-br from-[#5F00C2] to-[#2E073F] p-8 flex flex-col justify-between min-h-[400px] border border-white/10 hover:border-white/20 transition-all shadow-2xl shadow-[#5F00C2]/20"
                >
                    <!-- Background Art -->
                    <div class="absolute inset-0 bg-[url('/grid.svg')] opacity-20"></div>
                    <div class="absolute right-0 bottom-0 w-64 h-64 bg-gradient-to-tl from-black/40 to-transparent rounded-tl-full z-0"></div>
                    
                    <div class="relative z-10">
                        <div
                            class="inline-flex items-center gap-2 bg-black/30 backdrop-blur-md rounded-full px-3 py-1.5 mb-6 border border-white/10"
                        >
                            <span class="relative flex h-2 w-2">
                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                            </span>
                            <span class="text-xs font-bold text-white tracking-wide"
                                >FDA Cleared 2008</span
                            >
                        </div>
                        <h3 class="text-3xl md:text-4xl font-serif text-white mb-3">
                            Major Depressive Disorder
                        </h3>
                        <p class="text-white/80 text-lg leading-relaxed max-w-md font-light">
                            The primary application for TMS, offering hope for treatment-resistant depression with significant remission rates.
                        </p>
                    </div>

                    <div class="relative z-10 flex items-center gap-3 mt-8">
                        <span class="w-10 h-10 rounded-full bg-white text-[#5F00C2] flex items-center justify-center font-bold text-lg group-hover:scale-110 transition-transform">
                            →
                        </span>
                        <span class="text-white font-semibold text-sm tracking-wide">Explore Protocol</span>
                    </div>
                </a>

                <!-- Standard Cards -->
                {
                    TREATMENT_SLUGS.slice(1, 5).map((t, index) => (
                        <a
                            href={`/treatments/${t.slug}`}
                            class="group relative overflow-hidden bg-[#1a1025] hover:bg-[#251635] border border-white/5 hover:border-[#5F00C2]/30 rounded-3xl p-6 transition-all duration-300 flex flex-col justify-between h-full hover:-translate-y-1 hover:shadow-xl hover:shadow-[#5F00C2]/10"
                        >
                            <div>
                                <div class="w-12 h-12 rounded-2xl bg-[#5F00C2]/10 text-[#7C3AED] flex items-center justify-center mb-4 group-hover:bg-[#5F00C2] group-hover:text-white transition-colors duration-300">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                <h3 class="text-xl font-bold text-white mb-2 font-serif">
                                    {t.title.replace("TMS for ", "")}
                                </h3>
                                <p class="text-sm text-slate-400 leading-snug">
                                    Targeted therapy options for {t.slug.replace("-", " ")}.
                                </p>
                            </div>
                            <div class="mt-4 flex items-center gap-2 text-[#7C3AED] text-sm font-bold group-hover:text-white transition-colors">
                                Learn More <span class="transition-transform group-hover:translate-x-1">→</span>
                            </div>
                        </a>
                    ))
                }
                
                <!-- "View All" Card -->
                 <!-- <a
                    href="/treatments/"
                    class="group relative overflow-hidden bg-white rounded-3xl p-6 transition-all duration-300 flex flex-col justify-center items-center text-center h-full hover:shadow-xl"
                >
                    <div class="w-14 h-14 rounded-full bg-slate-100 text-slate-900 flex items-center justify-center mb-3 group-hover:bg-[#5F00C2] group-hover:text-white transition-colors duration-300">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </div>
                    <span class="font-bold text-slate-900 group-hover:text-[#5F00C2] transition-colors">View All Conditions</span>
                </a> -->
            </div>
        </div>
    </section>

    <!-- TECHNOLOGY - Compact -->
    <section class="py-12 bg-white">
        <div class="container mx-auto px-4">
            <div class="text-center mb-8">
                <span
                    class="inline-block px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-bold uppercase tracking-wider mb-2"
                    >Compare Technology</span
                >
                <h2 class="text-2xl md:text-3xl font-black text-gray-900">
                    Leading TMS Devices
                </h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- NeuroStar -->
                <a
                    href="/technology/neurostar/"
                    class="group flex flex-col bg-white rounded-3xl p-6 border border-slate-100 hover:border-[#5F00C2]/30 hover:shadow-xl hover:shadow-[#5F00C2]/10 transition-all duration-300"
                >
                    <div class="h-16 flex items-center justify-start mb-6">
                        <img 
                            src="https://neurostar.com/wp-content/themes/neurostar/assets/images/NeuroStar_Logo.svg" 
                            alt="NeuroStar Advanced Therapy" 
                            class="h-full w-auto object-contain max-w-[180px]"
                        />
                    </div>
                    <div class="mb-4">
                        <div class="text-xs font-bold text-[#5F00C2] uppercase tracking-wider mb-2">Best For: Establish Reputation</div>
                        <h3 class="text-lg font-bold text-slate-900 leading-tight mb-2">The Market Leader</h3>
                        <p class="text-slate-500 text-sm leading-relaxed">
                            "The most widely recognized name in TMS. Patients frequently cite the confidence that comes with its long history of FDA clearance and widespread insurance coverage."
                        </p>
                    </div>
                    <div class="mt-auto pt-4 border-t border-slate-50 flex items-center justify-between">
                         <span class="text-slate-400 text-xs font-medium">3,000+ Systems</span>
                         <span class="text-[#5F00C2] text-sm font-bold group-hover:translate-x-1 transition-transform">View Clinics →</span>
                    </div>
                </a>

                <!-- BrainsWay -->
                <a
                    href="/technology/brainsway-deep-tms/"
                    class="group flex flex-col bg-white rounded-3xl p-6 border border-slate-100 hover:border-[#5F00C2]/30 hover:shadow-xl hover:shadow-[#5F00C2]/10 transition-all duration-300"
                >
                    <div class="h-16 flex items-center justify-start mb-6">
                        <img 
                            src="https://www.brainsway.com/wp-content/uploads/2021/04/BrainsWay-2021-logo_full-color_black-name-1-e1619462194423.png" 
                            alt="BrainsWay Deep TMS" 
                            class="h-10 w-auto object-contain max-w-[180px]"
                        />
                    </div>
                    <div class="mb-4">
                        <div class="text-xs font-bold text-[#5F00C2] uppercase tracking-wider mb-2">Best For: OCD & Deep Structures</div>
                        <h3 class="text-lg font-bold text-slate-900 leading-tight mb-2">Deep TMS (H-Coil)</h3>
                        <p class="text-slate-500 text-sm leading-relaxed">
                            "Reviews consistently highlight its efficacy for OCD. Patients appreciate the helmet design which ensures consistent coil positioning for deep brain penetration."
                        </p>
                    </div>
                    <div class="mt-auto pt-4 border-t border-slate-50 flex items-center justify-between">
                         <span class="text-slate-400 text-xs font-medium">H-Coil Technology</span>
                         <span class="text-[#5F00C2] text-sm font-bold group-hover:translate-x-1 transition-transform">View Clinics →</span>
                    </div>
                </a>

                <!-- MagVenture -->
                <a
                    href="/technology/magventure/"
                    class="group flex flex-col bg-white rounded-3xl p-6 border border-slate-100 hover:border-[#5F00C2]/30 hover:shadow-xl hover:shadow-[#5F00C2]/10 transition-all duration-300"
                >
                    <div class="h-16 flex items-center justify-start mb-6">
                         <img 
                            src="https://neuronewsinternational.com/wp-content/uploads/sites/3/2024/05/MagVenture-logo-featured.jpg" 
                            alt="MagVenture TMS" 
                            class="h-14 w-auto object-contain max-w-[180px] mix-blend-multiply"
                        />
                    </div>
                    <div class="mb-4">
                        <div class="text-xs font-bold text-[#5F00C2] uppercase tracking-wider mb-2">Best For: Speed & Versatility</div>
                        <h3 class="text-lg font-bold text-slate-900 leading-tight mb-2">Research Favorite</h3>
                        <p class="text-slate-500 text-sm leading-relaxed">
                            "Highly regarded for its 'Theta Burst' capability, allowing for 3-minute sessions. Patients love the time efficiency without compromising clinical outcomes."
                        </p>
                    </div>
                    <div class="mt-auto pt-4 border-t border-slate-50 flex items-center justify-between">
                         <span class="text-slate-400 text-xs font-medium">3-Min Sessions</span>
                         <span class="text-[#5F00C2] text-sm font-bold group-hover:translate-x-1 transition-transform">View Clinics →</span>
                    </div>
                </a>

                <!-- Apollo TMS -->
                <a
                    href="/technology/apollo-tms/"
                    class="group flex flex-col bg-white rounded-3xl p-6 border border-slate-100 hover:border-[#5F00C2]/30 hover:shadow-xl hover:shadow-[#5F00C2]/10 transition-all duration-300"
                >
                    <div class="h-16 flex items-center justify-start mb-6">
                         <img 
                            src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS95RvWVC2pIymNtuccsRAMKtSuZmU_pAHsfQ&s" 
                            alt="Apollo TMS" 
                            class="h-12 w-auto object-contain max-w-[180px] mix-blend-multiply"
                        />
                    </div>
                    <div class="mb-4">
                        <div class="text-xs font-bold text-[#5F00C2] uppercase tracking-wider mb-2">Best For: Patient Comfort</div>
                        <h3 class="text-lg font-bold text-slate-900 leading-tight mb-2">Ergonomic Design</h3>
                        <p class="text-slate-500 text-sm leading-relaxed">
                            "Users often praise the Apollo system for its adjustable 'HANS' positioning and comfortable chair, making the 20-minute daily sessions more relaxing."
                        </p>
                    </div>
                    <div class="mt-auto pt-4 border-t border-slate-50 flex items-center justify-between">
                         <span class="text-slate-400 text-xs font-medium">Patient Focused</span>
                         <span class="text-[#5F00C2] text-sm font-bold group-hover:translate-x-1 transition-transform">View Clinics →</span>
                    </div>
                </a>

                <!-- CloudTMS -->
                <a
                    href="/technology/cloudtms/"
                    class="group flex flex-col bg-white rounded-3xl p-6 border border-slate-100 hover:border-[#5F00C2]/30 hover:shadow-xl hover:shadow-[#5F00C2]/10 transition-all duration-300"
                >
                    <div class="h-16 flex items-center justify-start mb-6">
                         <img 
                            src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSCJmEAxcCP5r_c64O63lpys4QTJ5lm3Jvbdg&s" 
                            alt="CloudTMS" 
                            class="h-12 w-auto object-contain max-w-[180px] mix-blend-multiply"
                        />
                    </div>
                    <div class="mb-4">
                        <div class="text-xs font-bold text-[#5F00C2] uppercase tracking-wider mb-2">Best For: Open Design</div>
                        <h3 class="text-lg font-bold text-slate-900 leading-tight mb-2">Modern & Airy</h3>
                        <p class="text-slate-500 text-sm leading-relaxed">
                            "The system's open-air coil design is a favorite among patients who might feel claustrophobic. It offers a sleek, modern treatment experience."
                        </p>
                    </div>
                    <div class="mt-auto pt-4 border-t border-slate-50 flex items-center justify-between">
                         <span class="text-slate-400 text-xs font-medium">Scalable Tech</span>
                         <span class="text-[#5F00C2] text-sm font-bold group-hover:translate-x-1 transition-transform">View Clinics →</span>
                    </div>
                </a>
            </div>

            <div class="text-center mt-6">
                <a
                    href="/compare/neurostar-vs-brainsway/"
                    class="inline-flex items-center gap-2 px-6 py-3 bg-gray-900 text-white font-bold rounded-xl hover:bg-gray-800 transition-colors text-sm"
                >
                    Compare All Technologies
                </a>
            </div>
        </div>
    </section>

  
    <!-- STATE DIRECTORY - Enhanced -->
    <section class="py-20 bg-[#0a0512] relative overflow-hidden" id="locations">
        <!-- Decoration -->
        <div class="absolute inset-0 bg-[url('/grid.svg')] opacity-[0.02]"></div>
        
        <div class="container mx-auto px-4 relative z-10 ">
            <div class="flex flex-col md:flex-row items-end justify-between mb-12 gap-6">
                <div>
                     <span class="inline-block px-3 py-1 bg-[#5F00C2]/10 text-[#5F00C2] border border-[#5F00C2]/20 rounded-full text-xs font-bold uppercase tracking-wider mb-4">
                        National Network
                    </span>
                    <h2 class="text-3xl md:text-4xl font-black text-white leading-tight">
                        Find Care <span class="text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Near You</span>
                    </h2>
                </div>
                
                <a href="/us/" class="hidden md:flex items-center gap-2 text-slate-400 hover:text-white transition-colors font-semibold text-sm group">
                    View Full Directory
                    <span class="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center text-white group-hover:bg-[#5F00C2] transition-colors">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </span>
                </a>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                {
                    locationMap.slice(0, 24).map((state) => (
                        <a
                            href={`/us/${state.slug}/`}
                            class="group flex items-center justify-between p-4 bg-white/[0.03] border border-white/10 rounded-2xl hover:bg-[#5F00C2] hover:border-[#5F00C2] hover:shadow-[0_0_20px_rgba(95,0,194,0.3)] transition-all duration-300"
                        >
                            <div class="flex items-center gap-3">
                                <span class="w-2 h-2 rounded-full bg-[#5F00C2] group-hover:bg-white transition-colors"></span>
                                <span class="font-bold text-slate-200 group-hover:text-white text-sm sm:text-base">
                                    {state.name}
                                </span>
                            </div>
                            
                            <div class="flex items-center gap-2">
                                <span class="text-xs font-medium text-slate-500 group-hover:text-white/80 bg-white/5 group-hover:bg-white/20 px-2 py-1 rounded-md transition-colors">
                                    {state.clinicCount}
                                </span>
                            </div>
                        </a>
                    ))
                }
            </div>

            <div class="mt-10 text-center md:hidden">
                 <a href="/us/" class="inline-flex items-center gap-2 px-6 py-3 bg-white/10 text-white font-bold rounded-xl hover:bg-[#5F00C2] transition-colors text-sm w-full justify-center">
                    View Complete Directory
                </a>
            </div>
        </div>
    </section>

    <!-- FAQ - Compact -->
    <section class="py-12 bg-white">
        <div class="container mx-auto px-4 max-w-4xl">
            <div class="text-center mb-6">
                <span
                    class="inline-block px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-bold uppercase tracking-wider mb-2"
                    >FAQ</span
                >
                <h2 class="text-2xl md:text-3xl font-black text-gray-900">
                    Common Questions
                </h2>
            </div>

            <div class="space-y-2">
                <details
                    class="group bg-gray-50 rounded-xl overflow-hidden border border-gray-100"
                >
                    <summary
                        class="flex justify-between items-center p-4 cursor-pointer list-none font-bold text-gray-900 group-open:bg-indigo-50 group-open:text-indigo-900 transition-colors"
                    >
                        <span>Is TMS covered by insurance?</span>
                        <svg
                            class="w-5 h-5 transition-transform group-open:rotate-180"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            ><path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M19 9l-7 7-7-7"></path></svg
                        >
                    </summary>
                    <div class="p-4 pt-0 text-gray-600 text-sm">
                        Yes! Most major insurers cover TMS for
                        treatment-resistant depression, including Medicare,
                        BlueCross, Aetna, Cigna, and UnitedHealthcare. Typically
                        requires 2+ failed antidepressants.
                    </div>
                </details>

                <details
                    class="group bg-gray-50 rounded-xl overflow-hidden border border-gray-100"
                >
                    <summary
                        class="flex justify-between items-center p-4 cursor-pointer list-none font-bold text-gray-900 group-open:bg-indigo-50 group-open:text-indigo-900 transition-colors"
                    >
                        <span>How many sessions are needed?</span>
                        <svg
                            class="w-5 h-5 transition-transform group-open:rotate-180"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            ><path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M19 9l-7 7-7-7"></path></svg
                        >
                    </summary>
                    <div class="p-4 pt-0 text-gray-600 text-sm">
                        Standard course: 36 sessions over 6-9 weeks (5/week for
                        4-6 weeks + taper). Each session is 19-37 minutes. Some
                        protocols like SAINT compress to 5 days.
                    </div>
                </details>

                <details
                    class="group bg-gray-50 rounded-xl overflow-hidden border border-gray-100"
                >
                    <summary
                        class="flex justify-between items-center p-4 cursor-pointer list-none font-bold text-gray-900 group-open:bg-indigo-50 group-open:text-indigo-900 transition-colors"
                    >
                        <span>Does TMS have side effects?</span>
                        <svg
                            class="w-5 h-5 transition-transform group-open:rotate-180"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            ><path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M19 9l-7 7-7-7"></path></svg
                        >
                    </summary>
                    <div class="p-4 pt-0 text-gray-600 text-sm">
                        No systemic side effects (weight gain, sexual
                        dysfunction, cognitive issues). Some experience mild
                        scalp discomfort initially. Very small (&lt;0.1%)
                        seizure risk.
                    </div>
                </details>

                <details
                    class="group bg-gray-50 rounded-xl overflow-hidden border border-gray-100"
                >
                    <summary
                        class="flex justify-between items-center p-4 cursor-pointer list-none font-bold text-gray-900 group-open:bg-indigo-50 group-open:text-indigo-900 transition-colors"
                    >
                        <span>Am I a candidate for TMS?</span>
                        <svg
                            class="w-5 h-5 transition-transform group-open:rotate-180"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            ><path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M19 9l-7 7-7-7"></path></svg
                        >
                    </summary>
                    <div class="p-4 pt-0 text-gray-600 text-sm">
                        Good candidate if you have MDD that hasn't responded to
                        medication. Not recommended if you have metal implants
                        near head or seizure history. <a
                            href="/quiz/am-i-a-candidate/"
                            class="text-indigo-600 font-bold hover:underline"
                            >Take our free quiz</a
                        >.
                    </div>
                </details>
            </div>
        </div>
    </section>

    <!-- Q&A KNOWLEDGE BASE - NEW -->
    <section class="py-10 bg-[#050a14] relative overflow-hidden">
        <!-- Dynamic Background -->
        <div class="absolute inset-0">
             <div class="absolute top-0 left-1/4 w-[800px] h-[800px] bg-[#5F00C2]/15 rounded-full blur-[120px] animate-pulse-slow"></div>
             <div class="absolute bottom-0 right-1/4 w-[600px] h-[600px] bg-cyan-900/20 rounded-full blur-[100px]"></div>
             <div class="absolute inset-0 bg-[url('/grid.svg')] opacity-[0.03]"></div>
        </div>

        <div class="container mx-auto px-4 relative z-10">
            <!-- Header & Search -->
            <div class="text-center max-w-3xl mx-auto mb-16">
                <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#5F00C2]/10 border border-[#5F00C2]/20 text-[#7C3AED] text-xs font-bold uppercase tracking-widest mb-6">
                    <span class="w-1.5 h-1.5 rounded-full bg-[#5F00C2] animate-pulse"></span>
                    TMS Intelligence
                </span>
                
                <h2 class="text-4xl md:text-5xl font-black text-white mb-6 tracking-tight">
                    Your Questions, <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-[#7C3AED]">Solved.</span>
                </h2>
                
                <!-- Search Component -->
                <div class="relative group max-w-2xl mx-auto">
                    <div class="absolute -inset-1 bg-gradient-to-r from-[#5F00C2] to-cyan-500 rounded-2xl blur opacity-25 group-hover:opacity-60 transition duration-500"></div>
                    <form action="/questions/" class="relative flex items-center bg-[#0f172a] border border-white/10 rounded-2xl p-2 shadow-2xl">
                        <div class="flex-1 flex items-center px-4">
                            <svg class="w-6 h-6 text-slate-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            <input type="text" placeholder="Search the knowledge base..." class="w-full bg-transparent text-white placeholder-slate-500 focus:outline-none text-lg h-12" />
                        </div>
                        <button type="submit" class="hidden sm:flex px-6 py-3 bg-[#5F00C2] hover:bg-[#4C1D95] text-white font-bold rounded-xl transition-colors">
                            Search
                        </button>
                    </form>
                </div>

                <!-- Quick Topics -->
                <div class="flex flex-wrap justify-center gap-3 mt-8">
                    <span class="text-sm text-slate-500 font-medium mr-2">Quick Access:</span>
                    <a href="/questions/how-much-does-tms-cost/" class="px-3 py-1 bg-white/5 hover:bg-white/10 border border-white/5 rounded-full text-xs font-medium text-slate-300 transition-colors">💰 Cost & Insurance</a>
                    <a href="/questions/does-tms-hurt/" class="px-3 py-1 bg-white/5 hover:bg-white/10 border border-white/5 rounded-full text-xs font-medium text-slate-300 transition-colors">🩺 Side Effects</a>
                    <a href="/questions/does-tms-work-for-depression/" class="px-3 py-1 bg-white/5 hover:bg-white/10 border border-white/5 rounded-full text-xs font-medium text-slate-300 transition-colors">📈 Success Rates</a>
                </div>
            </div>

            <!-- Knowledge Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                <!-- Card 1 -->
                <a href="/questions/what-is-tms-therapy/" class="group relative bg-[#111827] border border-white/5 rounded-2xl p-6 hover:border-[#5F00C2]/50 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:shadow-[#5F00C2]/10">
                    <div class="mb-4">
                        <div class="w-10 h-10 rounded-lg bg-cyan-500/10 text-cyan-400 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                        </div>
                        <h3 class="text-lg font-bold text-white mb-2 leading-tight group-hover:text-cyan-400 transition-colors">What is TMS Therapy?</h3>
                        <p class="text-sm text-slate-400 leading-relaxed">It's a non-invasive procedure that uses magnetic fields to stimulate nerve cells in the brain to improve symptoms of depression.</p>
                    </div>
                </a>

                <!-- Card 2 -->
                <a href="/questions/how-much-does-tms-cost/" class="group relative bg-[#111827] border border-white/5 rounded-2xl p-6 hover:border-emerald-500/50 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:shadow-emerald-500/10">
                    <div class="mb-4">
                        <div class="w-10 h-10 rounded-lg bg-emerald-500/10 text-emerald-400 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                        <h3 class="text-lg font-bold text-white mb-2 leading-tight group-hover:text-emerald-400 transition-colors">Cost & Insurance</h3>
                         <p class="text-sm text-slate-400 leading-relaxed">Typical courses run $6,000-$12,000, but most major insurance providers (Medicare, BCBS) now offer coverage.</p>
                    </div>
                </a>

                <!-- Card 3 -->
                <a href="/questions/does-tms-hurt/" class="group relative bg-[#111827] border border-white/5 rounded-2xl p-6 hover:border-rose-500/50 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:shadow-rose-500/10">
                    <div class="mb-4">
                        <div class="w-10 h-10 rounded-lg bg-rose-500/10 text-rose-400 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        </div>
                        <h3 class="text-lg font-bold text-white mb-2 leading-tight group-hover:text-rose-400 transition-colors">Is it Painful?</h3>
                         <p class="text-sm text-slate-400 leading-relaxed">Most patients report a tapping sensation on the scalp. It is generally well-tolerated with no recovery time needed.</p>
                    </div>
                </a>

                <!-- Card 4 -->
                <a href="/questions/tms-vs-ketamine/" class="group relative bg-[#111827] border border-white/5 rounded-2xl p-6 hover:border-purple-500/50 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:shadow-purple-500/10">
                    <div class="mb-4">
                        <div class="w-10 h-10 rounded-lg bg-purple-500/10 text-purple-400 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path></svg>
                        </div>
                        <h3 class="text-lg font-bold text-white mb-2 leading-tight group-hover:text-purple-400 transition-colors">TMS vs. Ketamine</h3>
                         <p class="text-sm text-slate-400 leading-relaxed">TMS is non-drug and non-invasive. Ketamine is a chemical treatment. Compare efficacy and side effects.</p>
                    </div>
                </a>

                <!-- Card 5 -->
                 <a href="/questions/does-tms-work-for-depression/" class="group relative bg-[#111827] border border-white/5 rounded-2xl p-6 hover:border-yellow-500/50 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:shadow-yellow-500/10">
                    <div class="mb-4">
                        <div class="w-10 h-10 rounded-lg bg-yellow-500/10 text-yellow-400 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                        <h3 class="text-lg font-bold text-white mb-2 leading-tight group-hover:text-yellow-400 transition-colors">Success Rates</h3>
                         <p class="text-sm text-slate-400 leading-relaxed">Approx 60% of treatment-resistant patients see improvement, with 1 in 3 achieving full remission.</p>
                    </div>
                </a>

                <!-- Explore All -->
                 <a href="/questions/" class="group relative bg-[#1c2438] hover:bg-[#5F00C2] rounded-2xl p-6 transition-all duration-300 flex flex-col items-center justify-center text-center">
                    <div class="w-12 h-12 rounded-full bg-white/10 text-white flex items-center justify-center mb-4 group-hover:bg-white group-hover:text-[#5F00C2] transition-colors">
                         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                    </div>
                    <span class="font-bold text-white text-lg">Detailed Guides</span>
                    <span class="text-sm text-slate-400 group-hover:text-white/80 mt-1">Explore 100+ Topics</span>
                </a>
            </div>
        </div>


    </section>

    <!-- FINAL CTA - QUANTUM STRIP -->
    <section class="py-10 bg-[#020617] relative overflow-hidden border-t border-[#5F00C2]/30">
        <!-- Animated Energy Effect -->
        <div class="absolute inset-0 z-0">
             <div class="absolute inset-0 bg-[#5F00C2]/5 bg-[url('/grid.svg')] opacity-20"></div>
             <div class="absolute top-0 inset-x-0 h-[1px] bg-gradient-to-r from-transparent via-[#5F00C2] to-transparent w-full opacity-70 animate-pulse"></div>
             <div class="absolute -left-20 top-0 w-96 h-96 bg-cyan-500/10 rounded-full blur-[128px]"></div>
             <div class="absolute -right-20 bottom-0 w-96 h-96 bg-[#5F00C2]/10 rounded-full blur-[128px]"></div>
        </div>

        <div class="container mx-auto px-4 relative z-10">
            <div class="flex flex-col lg:flex-row items-center justify-between gap-8 rounded-3xl bg-white/5 backdrop-blur-md border border-white/5 p-8 lg:px-12 lg:py-10 relative overflow-hidden group">
                <!-- Hover Glow -->
                <div class="absolute -inset-1 bg-gradient-to-r from-cyan-500/20 via-[#5F00C2]/20 to-cyan-500/20 rounded-3xl opacity-0 group-hover:opacity-100 transition duration-700 blur"></div>
                
                <!-- Content Left -->
                <div class="text-center lg:text-left relative z-10 max-w-2xl">
                    <h2 class="text-3xl font-black text-white mb-2 tracking-tight">
                        <span class="inline-block animate-pulse text-cyan-400 mr-2">●</span>
                        Ready to Transform Your Life?
                    </h2>
                    <p class="text-indigo-200 text-lg">
                        Join thousands who have found relief. No drugs, no surgery, just <span class="text-white font-bold">results.</span>
                    </p>
                </div>

                <!-- Actions Right -->
                <div class="flex flex-col sm:flex-row items-center gap-4 relative z-10 w-full lg:w-auto">
                    <a href="/us/" class="w-full sm:w-auto px-8 py-4 bg-white text-[#0F172A] font-bold text-lg rounded-xl shadow-[0_0_20px_rgba(255,255,255,0.3)] hover:shadow-[0_0_30px_rgba(94,234,212,0.6)] hover:bg-cyan-50 hover:scale-105 transition-all flex items-center justify-center gap-2 group/btn">
                        <svg class="w-5 h-5 text-[#5F00C2] group-hover/btn:text-[#0F172A] transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        Find a Clinic
                    </a>
                    
                    <a href="/quiz/am-i-a-candidate/" class="w-full sm:w-auto px-8 py-4 bg-[#1E293B]/80 text-white font-bold text-lg rounded-xl border border-white/10 hover:bg-[#5F00C2] hover:border-[#5F00C2] transition-all flex items-center justify-center gap-2 group/btn2">
                        <span>Check Eligibility</span>
                        <svg class="w-5 h-5 group-hover/btn2:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                    </a>
                </div>
            </div>
        </div>
    </section>
</Layout>

<script define:vars={{ searchData }}>
    const searchInput = document.getElementById("hero-search-input");
    const suggestionsBox = document.getElementById("search-suggestions");
    let selectedIndex = -1;

    if (searchInput && suggestionsBox) {
        searchInput.addEventListener("input", (e) => {
            const query = e.target.value.toLowerCase().trim();

            if (query.length < 2) {
                suggestionsBox.classList.add("hidden");
                return;
            }

            // Filter suggestions
            const matches = searchData
                .filter(
                    (item) =>
                        item.label.toLowerCase().includes(query) ||
                        (item.subLabel &&
                            item.subLabel.toLowerCase().includes(query)),
                )
                .slice(0, 8); // Limit to 8 results

            if (matches.length > 0) {
                suggestionsBox.innerHTML = matches
                    .map(
                        (item, index) => `
                    <div 
                        class="suggestion-item px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-50 last:border-0 flex items-center gap-3 transition-colors"
                        data-index="${index}"
                        data-value="${item.value}"
                    >
                        <div class="w-8 h-8 rounded-lg bg-gray-100 text-gray-400 flex items-center justify-center shrink-0">
                            ${getIconForType(item.type)}
                        </div>
                        <div>
                            <div class="font-bold text-gray-900 text-sm">${highlightMatch(item.label, query)}</div>
                            <div class="text-xs text-gray-500 font-medium uppercase tracking-wide">${item.subLabel}</div>
                        </div>
                    </div>
                `,
                    )
                    .join("");
                suggestionsBox.classList.remove("hidden");
            } else {
                suggestionsBox.classList.add("hidden");
            }
        });

        // Handle Keyboard Navigation
        searchInput.addEventListener("keydown", (e) => {
            const items = suggestionsBox.querySelectorAll(".suggestion-item");

            if (e.key === "ArrowDown") {
                e.preventDefault();
                selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
                updateSelection(items);
            } else if (e.key === "ArrowUp") {
                e.preventDefault();
                selectedIndex = Math.max(selectedIndex - 1, -1);
                updateSelection(items);
            } else if (e.key === "Enter") {
                if (selectedIndex >= 0) {
                    e.preventDefault();
                    items[selectedIndex].click();
                }
            } else if (e.key === "Escape") {
                suggestionsBox.classList.add("hidden");
            }
        });

        // Handle Click
        suggestionsBox.addEventListener("click", (e) => {
            const item = e.target.closest(".suggestion-item");
            if (item) {
                window.location.href = item.dataset.value;
            }
        });

        // Close on click outside
        document.addEventListener("click", (e) => {
            if (
                !searchInput.contains(e.target) &&
                !suggestionsBox.contains(e.target)
            ) {
                suggestionsBox.classList.add("hidden");
            }
        });
    }

    function updateSelection(items) {
        items.forEach((item, index) => {
            if (index === selectedIndex) {
                item.classList.add("bg-indigo-50");
            } else {
                item.classList.remove("bg-indigo-50");
            }
        });
    }

    function getIconForType(type) {
        if (type === "state")
            return `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;
        if (type === "city")
            return `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>`;
        return `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>`;
    }

    function highlightMatch(text, query) {
        const regex = new RegExp(`(${query})`, "gi");
        return text.replace(
            regex,
            '<span class="text-indigo-600 bg-indigo-50">$1</span>',
        );
    }
</script>

<style>
    .tms-brain-container {
        animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
        0%,
        100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-10px);
        }
    }

    .pulse-ring {
        animation: pulse-expand 2s ease-out infinite;
    }

    @keyframes pulse-expand {
        0% {
            transform: translateX(-50%) scale(0.5);
            opacity: 1;
        }
        100% {
            transform: translateX(-50%) scale(1.5);
            opacity: 0;
        }
    }

    .neuron-dot {
        animation: neuron-glow 1.5s ease-in-out infinite;
    }

    @keyframes neuron-glow {
        0%,
        100% {
            opacity: 0.3;
            transform: scale(0.8);
        }
        50% {
            opacity: 1;
            transform: scale(1.2);
        }
    }
</style>
